{"ast":null,"code":"import _regeneratorRuntime from\"/Users/dcash/Desktop/react_portfolio/react-rmdb-starterFiles_rev1/React_MDB_App_Portfolio_Example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/dcash/Desktop/react_portfolio/react-rmdb-starterFiles_rev1/React_MDB_App_Portfolio_Example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/dcash/Desktop/react_portfolio/react-rmdb-starterFiles_rev1/React_MDB_App_Portfolio_Example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/dcash/Desktop/react_portfolio/react-rmdb-starterFiles_rev1/React_MDB_App_Portfolio_Example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/dcash/Desktop/react_portfolio/react-rmdb-starterFiles_rev1/React_MDB_App_Portfolio_Example/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import{POPULAR_BASE_URL}from'../../config';export var useHomeFetch=function useHomeFetch(searchTerm){var _useState=useState({movies:[]}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var fetchMovies=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(endpoint){var isLoadMore,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setError(false);setLoading(true);isLoadMore=endpoint.search('page');_context.prev=3;_context.next=6;return fetch(endpoint);case 6:_context.next=8;return _context.sent.json();case 8:result=_context.sent;setState(function(prev){return _objectSpread(_objectSpread({},prev),{},{movies:isLoadMore!==-1?[].concat(_toConsumableArray(prev.movies),_toConsumableArray(result.results)):_toConsumableArray(result.results),heroImage:prev.heroImage||result.results[0],currentPage:result.page,totalPages:result.total_pages});});_context.next=16;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](3);setError(true);console.log(_context.t0);case 16:setLoading(false);case 17:case\"end\":return _context.stop();}}},_callee,null,[[3,12]]);}));return function fetchMovies(_x){return _ref.apply(this,arguments);};}();// Fetch popular movies initially on mount\nuseEffect(function(){if(sessionStorage.homeState){setState(JSON.parse(sessionStorage.homeState));setLoading(false);}else{fetchMovies(POPULAR_BASE_URL);}},[]);useEffect(function(){if(!searchTerm){sessionStorage.setItem('homeState',JSON.stringify(state));}},[searchTerm,state]);return[{state:state,loading:loading,error:error},fetchMovies];};","map":{"version":3,"sources":["/Users/dcash/Desktop/react_portfolio/react-rmdb-starterFiles_rev1/React_MDB_App_Portfolio_Example/src/components/hooks/useHomeFetch.js"],"names":["useState","useEffect","POPULAR_BASE_URL","useHomeFetch","searchTerm","movies","state","setState","loading","setLoading","error","setError","fetchMovies","endpoint","isLoadMore","search","fetch","json","result","prev","results","heroImage","currentPage","page","totalPages","total_pages","console","log","sessionStorage","homeState","JSON","parse","setItem","stringify"],"mappings":"4jCAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAAQC,gBAAR,KAA+B,cAA/B,CAEA,MAAO,IAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAAAC,UAAU,CAAI,eACdJ,QAAQ,CAAC,CAAEK,MAAM,CAAE,EAAV,CAAD,CADM,wCACjCC,KADiC,eAC1BC,QAD0B,8BAEVP,QAAQ,CAAC,KAAD,CAFE,yCAEjCQ,OAFiC,eAExBC,UAFwB,8BAGdT,QAAQ,CAAC,KAAD,CAHM,yCAGjCU,KAHiC,eAG1BC,QAH0B,eAKxC,GAAMC,CAAAA,WAAW,0FAAG,iBAAMC,QAAN,wIAClBF,QAAQ,CAAC,KAAD,CAAR,CACAF,UAAU,CAAC,IAAD,CAAV,CAEMK,UAJY,CAICD,QAAQ,CAACE,MAAT,CAAgB,MAAhB,CAJD,uCAOYC,CAAAA,KAAK,CAACH,QAAD,CAPjB,6CAO6BI,IAP7B,UAOVC,MAPU,eAQhBX,QAAQ,CAAC,SAAAY,IAAI,wCACRA,IADQ,MAEXd,MAAM,CACJS,UAAU,GAAK,CAAC,CAAhB,8BACIK,IAAI,CAACd,MADT,qBACoBa,MAAM,CAACE,OAD3B,sBAEIF,MAAM,CAACE,OAFX,CAHS,CAMXC,SAAS,CAAEF,IAAI,CAACE,SAAL,EAAkBH,MAAM,CAACE,OAAP,CAAe,CAAf,CANlB,CAOXE,WAAW,CAAEJ,MAAM,CAACK,IAPT,CAQXC,UAAU,CAAEN,MAAM,CAACO,WARR,IAAL,CAAR,CARgB,iFAoBhBd,QAAQ,CAAC,IAAD,CAAR,CACAe,OAAO,CAACC,GAAR,cArBgB,QAuBlBlB,UAAU,CAAC,KAAD,CAAV,CAvBkB,qEAAH,kBAAXG,CAAAA,WAAW,4CAAjB,CA0BA;AACAX,SAAS,CAAC,UAAM,CACd,GAAI2B,cAAc,CAACC,SAAnB,CAA8B,CAC5BtB,QAAQ,CAACuB,IAAI,CAACC,KAAL,CAAWH,cAAc,CAACC,SAA1B,CAAD,CAAR,CACApB,UAAU,CAAC,KAAD,CAAV,CACD,CAHD,IAGO,CACLG,WAAW,CAACV,gBAAD,CAAX,CACD,CACF,CAPQ,CAON,EAPM,CAAT,CASAD,SAAS,CAAC,UAAM,CACd,GAAI,CAACG,UAAL,CAAiB,CACdwB,cAAc,CAACI,OAAf,CAAuB,WAAvB,CAAoCF,IAAI,CAACG,SAAL,CAAe3B,KAAf,CAApC,EACF,CACF,CAJQ,CAIN,CAACF,UAAD,CAAaE,KAAb,CAJM,CAAT,CAOA,MAAO,CAAC,CAAEA,KAAK,CAALA,KAAF,CAASE,OAAO,CAAPA,OAAT,CAAkBE,KAAK,CAALA,KAAlB,CAAD,CAA2BE,WAA3B,CAAP,CACD,CAjDM","sourcesContent":["import { useState, useEffect } from 'react';\nimport {POPULAR_BASE_URL} from '../../config';\n\nexport const useHomeFetch = searchTerm => {\n  const [state, setState] = useState({ movies: [] });\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(false);\n\n  const fetchMovies = async endpoint => {\n    setError(false);\n    setLoading(true);\n\n    const isLoadMore = endpoint.search('page');\n\n    try {\n      const result = await (await fetch(endpoint)).json();\n      setState(prev => ({\n        ...prev,\n        movies:\n          isLoadMore !== -1\n        ? [...prev.movies, ...result.results]\n        : [...result.results],\n        heroImage: prev.heroImage || result.results[0],\n        currentPage: result.page,\n        totalPages: result.total_pages\n      }))\n\n    } catch (error) {\n      setError(true);\n      console.log(error);\n    }\n    setLoading(false);\n  }\n\n  // Fetch popular movies initially on mount\n  useEffect(() => {\n    if (sessionStorage.homeState) {\n      setState(JSON.parse(sessionStorage.homeState));\n      setLoading(false);\n    } else {\n      fetchMovies(POPULAR_BASE_URL);\n    }\n  }, [])\n\n  useEffect(() => {\n    if (!searchTerm) {\n       sessionStorage.setItem('homeState', JSON.stringify(state));\n    }\n  }, [searchTerm, state])\n\n\n  return [{ state, loading, error}, fetchMovies];\n}\n"]},"metadata":{},"sourceType":"module"}